## kin simulation
baremetal machine
https://docs.google.com/spreadsheets/d/1CcRQa9WWnkY_3fmGvXb5_IsR1Ik4nWnchxgVGUCz8AA/edit?usp=sharing
usr: sol

putty.exe -ssh sol@145.40.68.91
plink -batch ssh@myserver /etc/backups/do-backup.sh
pscp local_file user@thor.cs.wmich.edu:/home/path_to_the_folder/

// gensis commandline argument???
./multinode-demo/setup.sh solana-genesis

 Waiting for 80% of activated stake at slot 1 to be in gossip... 

// build all solana
cargo-install-all.sh

// download build from the CI and restart on the validator service
./update edge
/home/sol/.local

// rpc nodes
gcloud compute ssh testnet-kin-rpc-bm-1 --zone=us-east1-b
gcloud compute ssh testnet-kin-rpc-bm-2 --zone=us-east1-b
boot-scripts.sh

// scping files
gcloud compute scp solana-validator testnet-kin-rpc-bm-1:/home/haoran_yi_solana_com/  
gcloud compute scp solana-validator testnet-kin-rpc-bm-2:/home/haoran_yi_solana_com/  

systemd service
// restart service
sudo systemctl daemon-reload
sudo systemctl restart sol
sudo systemctl --no-pager status sol

// config service
sudo systemctl | grep sol
sudo systemctl edit sol


// check syslog for crash
sudo less /var/log/syslog

// gclound snapshot storage
https://cloud.google.com/storage/docs/gsutil_install#deb
gsutil cp gs://kin-snapshots/genesis/* .
gsutil cp gs://kin-snapshots/snapshot/snapshot-152000-4DBJcbqvTk9UaUabwrTECNPTnZc4CK7kB2pTZjT9jgVu.tar.zst .
gsutil cp gs://kin-snapshots/bin/solana-validator .

## service config file 
sol@dev-server-ny5:~$ cat /etc/systemd/system/sol.service
[Unit]
Description=Solana Validator
After=network.target
Wants=solana-sys-tuner

[Service]
Type=simple
Restart=always
RestartSec=1
User=sol
LimitNOFILE=500000
StartLimitIntervalSec=0
LogRateLimitIntervalSec=0
ExecStart=/home/sol/bin/validator.sh

[Install]
WantedBy=multi-user.target

## ledger tool command
~/solana-ledger-tool --ledger /home/sol/ledger/ create-snapshot 131030 >& 131030.log
~/solana-ledger-tool --ledger /home/sol/ledger/ verify --allow-dead-slots --accounts-db-skip-shrink --no-os-memory-stats-reporting --halt-at-slot 131040

// pattern to grep
grep "bank_frozen" 131040.1.10.da11.log
grep "bank frozen" 131040.1.10.da11.log
grep "bank frozen\|without_index" 131040.1.10.da11.log
grep "bank frozen\|without_index: slot" 131040.1.10.da11.log
grep "bank frozen\|without_index: slot" 131040.kin.log
grep 131040 solana-validator-AYJDiE3wgw5eanU4qJ4qfkB8vrHVEiBMTqXLbA9hUTaW.log
grep " bank frozen: 131040 hash:" solana-validator-AYJDiE3wgw5eanU4qJ4qfkB8vrHVEiBMTqXLbA9hUTaW.log
grep "bank frozen\|without_index: slot" 131040.kin.log
grep "failed to match" solana-validator-AYJDiE3wgw5eanU4qJ4qfkB8vrHVEiBMTqXLbA9hUTaW.log


~/solana-ledger-tool --ledger ~/131039_ledger/ copy --starting-slot 131039 --ending-slot 131040 --target-db ~/ledger
~/solana-ledger-tool --ledger /home/sol/ledger/ verify --allow-dead-slots --accounts-db-skip-shrink --halt-at-slot 131040 >& 131040.after_copy.log

restart 2022/5/23:
Successfully created snapshot for slot 99273, hash 7LqrSQiZQHqaQWAoyWL86zxLCrKG1jh8vBeYwNBp3GzT: /home/sol/ledger/snapshot-99273-9XQgP53GH2bqHLvKGfAePHPAN9a1tNwYRo4s9EzoMfRw.tar.zst
Shred version: 8321

file://snapshots_backup/no_cap/snapshot-99273-9XQgP53GH2bqHLvKGfAePHPAN9a1tNwYRo4s9EzoMfRw.tar.zst
gsutil cp gs://kin-snapshots/bank-hash/snapshot-99273-9XQgP53GH2bqHLvKGfAePHPAN9a1tNwYRo4s9EzoMfRw.tar.zst .
